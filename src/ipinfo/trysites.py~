#!/usr/bin/env python
# coding: utf-8

from ipinfo import sites
import rich
from time import sleep


def trysites() -> dict[str, str]:
    gs = sites.getsites()
    while True:
        try:
            # sleep delay included as primitive form of rate-limiting
            sleep(0.5)
            jdata = next(gs)()
            if (jdata.get("ip")):
                if type(jdata) == dict:
                    return jdata
                else:
                    return {"": ""}
        except StopIteration:
            break
    return {"": ""}


def main():
    finaldata = trysites()
    if not finaldata:
        print("None of the IP sites could return even a valid IP.",
              "Perhaps check your network connection?")
    else:
        rich.print(finaldata)


if __name__ == "__main__":
    main()
# remove this, just using it for testing
